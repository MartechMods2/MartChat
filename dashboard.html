<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mod Hive Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- TailwindCSS for styling -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background-color: #0a0a0a; color: #fff; font-family: 'Segoe UI', sans-serif; }
header { background-color: #111; padding: 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #00f0ff; }
header h1 { font-size: 1.5rem; color: #00f0ff; font-weight: bold; }
.nav-link { padding: 0.5rem 1rem; cursor: pointer; }
.nav-link:hover { background: #1a1a1a; border-radius: 6px; }
.tab-content { display: none; padding: 1rem; }
.tab-content.active { display: block; }
input, textarea { background: #1a1a1a; border: 1px solid #333; padding: 0.5rem; border-radius: 6px; color: #fff; width: 100%; }
button { background: #00f0ff; padding: 0.5rem 1rem; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; }
button:hover { background: #00c0cc; }
.message { padding: 0.5rem; border-bottom: 1px solid #222; }
.message strong { color: #00f0ff; }
</style>
</head>
<body>

<header>
  <h1>Mod Hive</h1>
  <div class="flex items-center gap-4">
    <img id="profilePhoto" src="" class="w-10 h-10 rounded-full border border-cyan-400" alt="Profile">
    <span id="nicknameDisplay"></span>
    <span id="rankDisplay" class="text-sm text-gray-400"></span>
    <span id="pointsDisplay" class="text-sm text-yellow-400"></span>
    <button onclick="logout()">Logout</button>
  </div>
</header>

<nav class="flex bg-black p-2 border-b border-cyan-500">
  <div class="nav-link" onclick="openTab('feed')">Feed</div>
  <div class="nav-link" onclick="openTab('globalChat')">Global Chat</div>
  <div class="nav-link" onclick="openTab('privateChat')">Private Chat</div>
  <div class="nav-link" onclick="openTab('friends')">Friends</div>
  <div class="nav-link" onclick="openTab('leaderboard')">Leaderboard</div>
  <div class="nav-link" onclick="openTab('profile')">Profile</div>
</nav>

<!-- Feed -->
<div id="feed" class="tab-content active">
  <h2 class="text-xl mb-2">Post Something</h2>
  <textarea id="postText" placeholder="What's on your mind?"></textarea>
  <button onclick="createPost()" class="mt-2">Post</button>
  <div id="postsList" class="mt-4"></div>
</div>

<!-- Global Chat -->
<div id="globalChat" class="tab-content">
  <h2 class="text-xl mb-2">Global Chat</h2>
  <div id="globalMessages" class="max-h-96 overflow-y-auto border border-gray-700 p-2 rounded"></div>
  <input id="globalMessageInput" placeholder="Type your message...">
  <button onclick="sendGlobalMessage()">Send</button>
</div>

<!-- Private Chat -->
<div id="privateChat" class="tab-content">
  <h2 class="text-xl mb-2">Private Chat</h2>
  <input id="privateFriendId" placeholder="Friend UID">
  <button onclick="startPrivateChat()">Start Chat</button>
  <div id="privateMessages" class="max-h-96 overflow-y-auto border border-gray-700 p-2 rounded mt-4"></div>
  <input id="privateMessageInput" placeholder="Type your private message...">
  <button onclick="sendPrivateMessage()">Send</button>
</div>

<!-- Friends -->
<div id="friends" class="tab-content">
  <h2 class="text-xl mb-2">Friends List</h2>
  <div id="friendsList"></div>
</div>

<!-- Leaderboard -->
<div id="leaderboard" class="tab-content">
  <h2 class="text-xl mb-2">Leaderboard</h2>
  <div id="leaderboardList"></div>
</div>

<!-- Profile -->
<div id="profile" class="tab-content">
  <h2 class="text-xl mb-2">Edit Profile</h2>
  <input id="nicknameInput" placeholder="Nickname">
  <input id="bioInput" placeholder="Bio">
  <input id="profilePhotoInput" placeholder="Photo URL">
  <button onclick="updateProfile()">Save</button>
  <footer>
  <p class="copyright-text" style="font-size:10px; margin-top:20px;">Copyright &copy; 2025 All Rights Reserved by 
         <a style="color:white; text-decoration:none;" href="ModHive.html">Modhive</a>.
            </p>
            </footer>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAgx0jy6we6cvnIgKbS1fBoeRfSD2MDszo",
  authDomain: "mod-hive.firebaseapp.com",
  projectId: "mod-hive",
  storageBucket: "mod-hive.firebasestorage.app",
  messagingSenderId: "982583858832",
  appId: "1:982583858832:web:44d5e4e2edd77fac06ea15",
  measurementId: "G-PK2DRED7FB"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ====== UI Tabs ====== */
function openTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
}

/* ====== Auth State ====== */
let currentUser;
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "auth.html";
    return;
  }
  currentUser = user;
  loadUserProfile();
  loadPosts();
  loadGlobalChat();
  loadLeaderboard();
});

/* ====== Profile ====== */
function loadUserProfile() {
  db.collection("users").doc(currentUser.uid).onSnapshot(doc => {
    if (doc.exists) {
      const data = doc.data();
      document.getElementById("nicknameDisplay").innerText = data.nickname || "";
      document.getElementById("rankDisplay").innerText = data.rank || "";
      document.getElementById("pointsDisplay").innerText = data.points + " pts";
      document.getElementById("profilePhoto").src = data.profilePhoto || "https://via.placeholder.com/40";
    }
  });
}
function updateProfile() {
  const nickname = document.getElementById("nicknameInput").value;
  const bio = document.getElementById("bioInput").value;
  const profilePhoto = document.getElementById("profilePhotoInput").value;
  db.collection("users").doc(currentUser.uid).set({
    nickname, bio, profilePhoto
  }, { merge: true });
}

/* ====== Posts ====== */
function createPost() {
  const text = document.getElementById("postText").value;
  if (!text) return;
  db.collection("posts").add({
    author: currentUser.uid,
    text,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    likeCount: 0
  });
  document.getElementById("postText").value = "";
}
function loadPosts() {
  db.collection("posts").orderBy("createdAt", "desc").onSnapshot(snap => {
    const list = document.getElementById("postsList");
    list.innerHTML = "";
    snap.forEach(doc => {
      const p = doc.data();
      const el = document.createElement("div");
      el.className = "p-2 border-b border-gray-700";
      el.innerHTML = `<strong>${p.author}</strong>: ${p.text}`;
      list.appendChild(el);
    });
  });
}

/* ====== Global Chat ====== */
function sendGlobalMessage() {
  const text = document.getElementById("globalMessageInput").value;
  if (!text) return;
  db.collection("chatGlobal").add({
    author: currentUser.uid,
    text,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("globalMessageInput").value = "";
}
function loadGlobalChat() {
  db.collection("chatGlobal").orderBy("createdAt").onSnapshot(snap => {
    const box = document.getElementById("globalMessages");
    box.innerHTML = "";
    snap.forEach(doc => {
      const m = doc.data();
      const el = document.createElement("div");
      el.className = "message";
      el.innerHTML = `<strong>${m.author}</strong>: ${m.text}`;
      box.appendChild(el);
    });
    box.scrollTop = box.scrollHeight;
  });
}

/* ====== Private Chat ====== */
let activeChatId;
function startPrivateChat() {
  const friendUid = document.getElementById("privateFriendId").value;
  if (!friendUid) return;
  activeChatId = [currentUser.uid, friendUid].sort().join("_");
  const chatDoc = db.collection("chatPrivate").doc(activeChatId);
  chatDoc.get().then(doc => {
    if (!doc.exists) {
      chatDoc.set({
        participants: [currentUser.uid, friendUid],
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
    loadPrivateMessages();
  });
}
function sendPrivateMessage() {
  if (!activeChatId) return;
  const text = document.getElementById("privateMessageInput").value;
  if (!text) return;
  db.collection("chatPrivate").doc(activeChatId).collection("messages").add({
    author: currentUser.uid,
    text,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("privateMessageInput").value = "";
}
function loadPrivateMessages() {
  db.collection("chatPrivate").doc(activeChatId).collection("messages").orderBy("createdAt").onSnapshot(snap => {
    const box = document.getElementById("privateMessages");
    box.innerHTML = "";
    snap.forEach(doc => {
      const m = doc.data();
      const el = document.createElement("div");
      el.className = "message";
      el.innerHTML = `<strong>${m.author}</strong>: ${m.text}`;
      box.appendChild(el);
    });
    box.scrollTop = box.scrollHeight;
  });
}

/* ====== Leaderboard ====== */
function loadLeaderboard() {
  db.collection("users").orderBy("points", "desc").limit(10).onSnapshot(snap => {
    const box = document.getElementById("leaderboardList");
    box.innerHTML = "";
    snap.forEach(doc => {
      const u = doc.data();
      const el = document.createElement("div");
      el.innerHTML = `${u.nickname || u.uid} - ${u.points} pts`;
      box.appendChild(el);
    });
  });
}

/* ====== Logout ====== */
function logout() {
  auth.signOut();
}
</script>

</body>
</html>
